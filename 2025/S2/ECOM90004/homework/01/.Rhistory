quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
# Filter for estimation period
filter(date >= as.Date("2000-03-01") & date <= as.Date("2018-12-01")) %>%
# Creating a time trend dummy
mutate(time = row_number() * 0.25)
data_2019 <- data.frame(time = seq(from = as.numeric(tail(data$date, 1)) + 0.25, by = 0.25, length.out = 4))
View(data_2019)
data_2019 <- data.frame(time = seq(from = as.numeric(tail(data$time, 1)) + 0.25, by = 0.25, length.out = 4))
data_2019 <- data.frame()
data_2019 <- data.frame() %>%
# Creating new time dummy values
mutate(time = seq(from = as.numeric(tail(data$time, 1)) + 0.25, by = 0.25, length.out = 4))
data_2019 <- data.frame(time = seq(from = as.numeric(tail(data$time, 1)) + 0.25, by = 0.25, length.out = 4))
data_2019 <- data.frame(time = seq(from = as.numeric(tail(data$time, 1)) + 0.25, by = 0.25, length.out = 4)) %>%
mutate(forecasts = predict(eq, newdata = data_2019))
data <- data %>%
mutate(time_prediction = predict(eq, newdata = data))
ggplot(data, aes(x = date)) +
geom_line(aes(y = y_log), color = "blue", size = 1) +
geom_line(aes(y = time_prediction), color = "red", size = 1, linetype = "dashed") +
labs(title = "Retail sales", y = "log(Retail sales)", x = "Date")
data_2019 <- data.frame(time = seq(from = as.numeric(tail(data$time, 1)) + 0.25, by = 0.25, length.out = 4)) %>%
mutate(forecasts = predict(eq, newdata = data_2019))
data_q1e <- data %>%
mutate(residuals = eq$resid)
View(data_q1e)
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
left_join(data_2019, by = time)
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
left_join(data_2019, by = "time")
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = "time")
data_2019 <- data_2019 %>%
mutate(forecasts = predict(eq, newdata = data_2019)) %>%
mutate(date = seq.Date(from = as.Date("2019-03-01"),
to = as.Date("2019-12-01"),
by = "3 months"))
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = "time")
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = c("date","time"))
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = c("date","time")) %>%
mutate(residuals = predict(eq, newdata = data_q1e))
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = c("date","time")) %>%
mutate(residuals = predict(eq, newdata = data_q1e)) %>%
mutate(forecast_error = y - forecasts) %>%
select(date, residuals, forecast_error)
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = c("date","time")) %>%
mutate(residuals = predict(eq, newdata = data_q1e))
data_q1e <- data
data_q1e <- data %>%
mutate(residuals = eq$resid)
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = c("date","time")) %>%
mutate(residuals = predict(eq, newdata = data_q1e))
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = c("date","time"))
data_q1e <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = c("date","time"))
data <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & =< as.Date("2019-12-01"))
data <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & date =< as.Date("2019-12-01"))
data <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & date <= as.Date("2019-12-01"))
data_2019 <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & date <= as.Date("2019-12-01"))
data <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
# Filter for estimation period
filter(date >= as.Date("2000-03-01") & date <= as.Date("2018-12-01")) %>%
# Creating a time trend dummy
mutate(time = row_number() * 0.25)
View(data_2019)
forecasts <- data.frame(time = seq(from = as.numeric(tail(data$time, 1)) + 0.25, by = 0.25, length.out = 4))
forecasts <- data_2019 %>%
mutate(forecasts = predict(eq, newdata = data_2019)) %>%
mutate(date = seq.Date(from = as.Date("2019-03-01"),
to = as.Date("2019-12-01"),
by = "3 months"))
forecasts <- forecasts %>%
mutate(forecasts = predict(eq, newdata = data_2019)) %>%
mutate(date = seq.Date(from = as.Date("2019-03-01"),
to = as.Date("2019-12-01"),
by = "3 months"))
forecasts <- forecasts
View(forecasts)
forecasts <- forecasts %>%
mutate(forecasts = predict(eq, newdata = forecasts)) %>%
mutate(date = seq.Date(from = as.Date("2019-03-01"),
to = as.Date("2019-12-01"),
by = "3 months"))
data_2019 <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & date <= as.Date("2019-12-01")) %>%
# Append forecast values
inner_join(forecasts, by = "date")
data_2019 <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & date <= as.Date("2019-12-01")) %>%
# Append forecast values
inner_join(forecasts, by = "date") %>%
# Produce forecast errors
mutate(forecast_errors = y_log - forecasts)
data <- data %>%
mutate(residuals = eq$resid)
data <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = "date")
data <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = "date") %>%
select(date, residuals, forecast_errors)
data <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = "date")
data <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
# Filter for estimation period
filter(date >= as.Date("2000-03-01") & date <= as.Date("2018-12-01")) %>%
# Creating a time trend dummy
mutate(time = row_number() * 0.25)
data_comparison <- data %>%
mutate(residuals = eq$resid) %>%
full_join(data_2019, by = "date") %>%
select(date, residuals, forecast_errors)
View(data_comparison)
ggplots(data_comparison, aes(x = date)) +
geom_line(aes(y = residuals), color = "blue", size = 1) +
geom_line(aes(y = forecast_errors), color = "red", size = 1) +
```
ggplots(data_comparison, aes(x = date)) +
geom_line(aes(y = residuals), color = "blue", size = 1) +
geom_line(aes(y = forecast_errors), color = "red", size = 1)
ggplot(data_comparison, aes(x = date)) +
geom_line(aes(y = residuals), color = "blue", size = 1) +
geom_line(aes(y = forecast_errors), color = "red", size = 1)
View(data)
View(data)
library(tidyverse)
library(tidyverse)
library(lubridate)
library(janitor)
theme_set(theme_minimal())
data <- data %>%
mutate(quarterly_dummy = quarter(date))
data <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
# Filter for estimation period
filter(date >= as.Date("2000-03-01") & date <= as.Date("2018-12-01")) %>%
# Creating a time trend dummy
mutate(time = row_number() * 0.25)
head(data)
### b) Estimate a linear regression of Y on time and interpret its coefficients.
```{r q1b}
eq <- lm(y_log~time, data = data)
summary(eq)
### c) Create a time series plot of Y with the fitted regression in the same axes.
```{r q1c}
data <- data %>%
mutate(time_prediction = predict(eq, newdata = data))
ggplot(data, aes(x = date)) +
geom_line(aes(y = y_log), color = "blue", size = 1) +
geom_line(aes(y = time_prediction), color = "red", size = 1, linetype = "dashed") +
labs(title = "Retail sales", y = "log(Retail sales)", x = "Date")
ggplot(data, aes(x = date)) +
geom_line(aes(y = y_log), color = "blue", size = 1) +
geom_line(aes(y = time_prediction), color = "red", size = 1, linetype = "dashed") +
labs(title = "Retail sales", y = "log(Retail sales)", x = "Date")
### d) Use the linear regresison to forecast the value of Y for the four quarters of 2019
``` {r q1d}
forecasts <- data.frame(time = seq(from = as.numeric(tail(data$time, 1)) + 0.25, by = 0.25, length.out = 4))
forecasts <- forecasts %>%
mutate(forecasts = predict(eq, newdata = forecasts)) %>%
mutate(date = seq.Date(from = as.Date("2019-03-01"),
to = as.Date("2019-12-01"),
by = "3 months"))
### e) Obtain the residuals of the linear regression in (b) and the forecast errors of the forecasts in (d). Plot these against time and comments on any pattern(s) you observe.
``` {r q1e}
data_2019 <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & date <= as.Date("2019-12-01")) %>%
# Append forecast values
inner_join(forecasts, by = "date") %>%
# Produce forecast errors
mutate(forecast_errors = y_log - forecasts)
ggplot(data_comparison, aes(x = date)) +
geom_line(aes(y = residuals), color = "blue", size = 1) +
geom_line(aes(y = forecast_errors), color = "red", size = 1)
# Q2
### a) Create a factor variable containing the seasons (quarters) of each observation.
```{r q2a }
data <- data %>%
mutate(quarterly_dummy = quarter(date))
eq2 <- lm(y_log ~ time + season)
eq2 <- lm(log_y ~ time + season)
eq2 <- lm(log_y ~ time + season, data = data)
eq2 <- lm(y_log ~ time + season, data = data)
data <- data %>%
mutate(season = quarter(date))
eq2 <- lm(y_log ~ time + season, data = data)
summary(eq2)
data <- data %>%
mutate(season = quarter(date)) %>%
mutate(
Q1 = as.integer(quarter(date) == 1),
Q2 = as.integer(quarter(date) == 2),
Q3 = as.integer(quarter(date) == 3),
Q4 = as.integer(quarter(date) == 4)
)
eq2 <- lm(y_log ~ time + Q1 + Q2 + Q3 + Q4, data = data)
summary(eq2)
eq2 <- lm(y_log ~ time + Q2 + Q3 + Q4, data = data)
summary(eq2)
eq2 <- lm(y ~ time + Q2 + Q3 + Q4, data = data)
summary(eq2)
print(eq2)
eq2 <- lm(y_log ~ time + Q2 + Q3 + Q4, data = data)
print(eq2)
View(data_2019)
data_2019 <- data_2019 %>%
mutate(season = quarter(date)) %>%
mutate(
Q1 = as.integer(quarter(date) == 1),
Q2 = as.integer(quarter(date) == 2),
Q3 = as.integer(quarter(date) == 3),
Q4 = as.integer(quarter(date) == 4)
)
data_2019 <- data_2019 %>%
mutate(season = quarter(date)) %>%
mutate(
Q1 = as.integer(quarter(date) == 1),
Q2 = as.integer(quarter(date) == 2),
Q3 = as.integer(quarter(date) == 3),
Q4 = as.integer(quarter(date) == 4)
) %>%
mutate(seasonal_fcst = predict(eq2, newdata = data_2019))
data_2019 <- data_2019 %>%
mutate(season = quarter(date)) %>%
mutate(
Q1 = as.integer(quarter(date) == 1),
Q2 = as.integer(quarter(date) == 2),
Q3 = as.integer(quarter(date) == 3),
Q4 = as.integer(quarter(date) == 4)
) %>%
mutate(fcst = predict(eq2, newdata = data_2019))
rm(data_2019)
data_2019 <- read_csv("retailsales.csv") %>%
clean_names() %>%
select(date, y = total) %>%
mutate(
date = my(date),
year = year(date),
quarter = quarter(date),
year_quarter = paste0(year,"Q",quarter),
quarter_end_date = case_when(
quarter == 1 ~ make_date(year, 3, 1),
quarter == 2 ~ make_date(year, 6, 1),
quarter == 3 ~ make_date(year, 9, 1),
quarter == 4 ~ make_date(year, 12, 1))
) %>%
group_by(quarter_end_date) %>%
summarise(y = sum(y, na.rm = TRUE)) %>%
select(date = quarter_end_date, y) %>%
# Creating log series
mutate(y_log = log(y)) %>%
filter(date >= as.Date("2019-03-01") & date <= as.Date("2019-12-01")) %>%
# Append forecast values
inner_join(forecasts, by = "date") %>%
# Produce forecast errors
mutate(forecast_errors = y_log - forecasts)
data_2019 <- data_2019 %>%
mutate(season = quarter(date)) %>%
mutate(
Q1 = as.integer(quarter(date) == 1),
Q2 = as.integer(quarter(date) == 2),
Q3 = as.integer(quarter(date) == 3),
Q4 = as.integer(quarter(date) == 4)
) %>%
mutate(fcst = predict(eq2, newdata = data_2019))
data_2019 <- data_2019
data_2019 <- data_2019 %>%
mutate(season = quarter(date)) %>%
mutate(
Q1 = as.integer(quarter(date) == 1),
Q2 = as.integer(quarter(date) == 2),
Q3 = as.integer(quarter(date) == 3),
Q4 = as.integer(quarter(date) == 4)
)
data_2019 <- data_2019 %>%
mutate(season = quarter(date)) %>%
mutate(
Q1 = as.integer(quarter(date) == 1),
Q2 = as.integer(quarter(date) == 2),
Q3 = as.integer(quarter(date) == 3),
Q4 = as.integer(quarter(date) == 4)
) %>%
mutate(fcst = predict(eq2, newdata = data_2019))
data_2019 <- data_2019 %>%
mutate(fcst = predict(eq2, newdata = data_2019))
data_2019 <- data_2019 %>%
mutate(fcst = predict(eq2, newdata = data_2019)) %>%
mutate(fcst_errors = y_log - fcst)
data_comparison_2 <- data %>%
mutate(residuals = eq2$residuals)
View(data_comparison_2)
data_comparison_2 <- data %>%
mutate(residuals = eq2$residuals) %>%
full_join(data_2019) %>%
select(date, residuals, fcst_errors)
ggplot(data_comparison2, aes(x = date)) +
geom_line(aes(y = residuals), color = "blue", size = 1) +
geom_line(aes(y = fcst_errors), color = "red", size = 1)
ggplot(data_comparison_2, aes(x = date)) +
geom_line(aes(y = residuals), color = "blue", size = 1) +
geom_line(aes(y = fcst_errors), color = "red", size = 1)
